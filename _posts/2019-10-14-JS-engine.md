---
title: 자바스크립트(1/2) - 엔진
date: 2019-10-14
categories:
    - javascript
tags:
    - javascript
---
# 들어가기 전
문득 자바스크립트 개발을 하면서 내부까지 공부를 해본 적이 없어서
이번 기회에 공부를 해보고자 한다.

이번 포스트에서는 엔진에 대하여 간략하게 알아 볼 예정이고, 다음 포스트에서는 어떻게 동작하는지를 알아 볼 예정이다.

![alt]({{ site.url }}{{ site.baseurl }}/assets/images/javascript.png)

<!--more-->

# 자바스크립트 엔진?
**자바스크립트 엔진**은 코드를 실행하는 프로그램 또는 인터프리터를 뜻한다.
표준적인 **인터프리터**로 구현 될 수 있고, 바이트 코드로 컴파일 하는 **저스트 인 타임(Just-In-Time / JIT)컴파일러**로 구현 될 수 있다.

### 대표적인 프로젝트
대표적인 자바스크립트 엔진은 **V8**이지만 이외에 다른 많은 엔진들이 있다.
(오늘 정리할 내용은 V8엔진 기반이다.)
 - V8 : 크롬
 - SpiderMonkey : 파이어폭스
 - JavaScriptCore : 사파리
 - Chakra (JScript9) : IE
 - Chakra (JavaScript) : Edge

# 왜 개발이 되었을까?
가장 주된 이유는 자바스크립트 내부에서 **자바스크립트 수행 속도의 개선**을 목표로 개발 되었다.
인터프리터를 사용하는 대신 자바스크립트 코드를 더 효율적인 머신 코드로 번역한다.
차이점은 다른 엔진들과의 차이점은 Node.js의 **런타임**으로도 이용된다는 것이다.

![alt]({{ site.url }}{{ site.baseurl }}/assets/images/v8.png)

# 차근차근 알아보자
우선 우리는 V8에 대하여 알아야 **컴파일러**와 **쓰레드**가 있다.

### 컴파일러
 - 풀코드젠 : 간단하고 매우 빠른 컴파일러로서 단순하고 상대적으로 느린 머신 코드를 제공한다.
 - 크랭크샤프트 : 좀 더 복잡한 JIT 최적화 컴파일러로서 고도로 최적화된 코드를 제공한다.

### 쓰레드
 - 메인쓰레드 : 코드를 가져와서 컴파일을 하고 실행한다.
 - 프로파일러 쓰레드 : 어떤 메소드에서 사용자가 많은 시간을 보내는지 런타임에게 알려주어서 크랭크샤프트가 이 내용을 토대로 최적화를 진행한다.
 - 기타로 GC(Garbage-Collector) 처리를 위한 쓰레드가 따로 있다.

### 실행 순서를 정리해보면...
 1. 처음 실행 시 V8엔진이 풀코드젠을 이용하여 파싱된 자바스크립트 코드를 변형 없이 머신 코드로 번역한다.
    - **변형이 없이 시작되어 머신 코드의 실행이 매우 빠르게 실행 될 수 있다.**
 2. V8은 중간에 바이트코드를 이용하지 않기 때문에 인터프리터가 필요 없게 된다.
 3. 코드가 얼마간 실행 된 후 프로파일러 쓰레드는 충분한 데이터를 얻게 되고, 어떤 메소드를 최적화 할지 알 수 있게 된다.
 4. 크랭크샤프트가 다른 쓰레드에서 최적화를 시작한다.
    - 자바스크립트의 추상 구문 트리를 **고수준 정적단일할당**(**Static-Single-Assignment, SSA**)으로 번역하게 되는데, 이를 **하이드로젠**(**hydrogen**)이라고 한다.
        - 추상구문트리란?
            - 프로그래밍 언어의 문법에 따라 소스 코드 구조를 표시하는 계층적 프로그램 표현 이다.
            - 자세한 내용은 2번째 시간에 따로 정리를 하도록 하겠다.
    - 대부분의 최적화가 이 단계에서 이루어지며, 크랭크샤프트는 또한 하이드로젠 그래프를 최적화하고자 한다.

# 마무리
오늘 포스팅에는 자바스크립트의 엔진(V8)그리고 실행순서에 대하여 간단하게 살펴보았다.
사실 최적화 과정에 내용이 더 있지만, 최적화 관련 내용 **인라이닝**, **히든클래스**, **인라인캐시**은 조금 더 공부 후 정리할려구 한다.

다음 포스팅에는 자바스크립트의 동작방식에 대해 정리를 해볼려구 한다.

# 참고
- [자바스크립트는 어떻게 작동하는가](https://engineering.huiseoul.com/자바스크립트는-어떻게-작동하는가-v8-엔진의-내부-최적화된-코드를-작성을-위한-다섯-가지-팁-6c6f9832c1d9)
- [자바스크립트 엔진](https://ko.wikipedia.org/wiki/자바스크립트_엔진)
